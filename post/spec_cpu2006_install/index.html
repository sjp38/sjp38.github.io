<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>spec_cpu2006_install</title>
  
  <meta name="author" content="SeongJae Park"/>
  <meta name="generator" content="Hugo 0.18-DEV" />
  

  <link rel="alternate" href="https://sjp38.github.io/index.xml" type="application/rss+xml" title="Happy Hacking">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://sjp38.github.io/css/highlight.min.css">
  
  
  <meta property="og:title" content="spec_cpu2006_install" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/post/spec_cpu2006_install/" />
  <meta property="og:image" content="/" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://sjp38.github.io/">Happy Hacking</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
          <a title="about" href="/post/about/">about</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Categories" href="/categories">Categories</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Projects" href="/categories/projects">Projects</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Tags" href="/tags">Tags</a>
  	      </li>
  	    
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
	  </div>
	</div>

  </div>
</nav>

    



  

  <header class="header-section ">
  
  <div class="intro-header no-img">
      <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>spec_cpu2006_install</h1>
      
      
      
      <span class="post-meta">Posted on March 29, 2017</span>
      
        </div>
      </div>
    </div>
  </div>
  </div>
  </header>


    <div class="container" role="main">	  
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
          

<p>SPEC 은 벤치마크를 위한 협력기구 [0] 로, 다양한 벤치마크 suite 들을 만들고
공유합니다.  SPEC CPU 2006 은 여기서 만든 벤치마크 도구집합 중 하나 [1] 로 계산
작업 집중적인 워크로드에 대한 성능을 측정을 목표로 만들어졌으며, 많은 곳에서
사용되고 있습니다.  2006년 1.0 버전이, 2008년에 1.1 버전이, 그리고 2011년에 1.2
버전이 나왔습니다.  본 글은 Ubuntu 16.04 서버 위에서의 SPEC CPU 2006 v1.1 의
설치에 대해 간단히 설명합니다.</p>

<h1 id="설치-환경">설치 환경</h1>

<p>본 글에서 설명하는 내용은 다음과 같은 환경의 머신 위에서 수행되었습니다:</p>

<ul>
<li>Intel Xeon E7-8870 v3</li>
<li>Linux 4.10 kernel</li>
<li>Ubuntu 16.04.1 Server version</li>
</ul>

<h1 id="소스-코드-구하기">소스 코드 구하기</h1>

<p>먼저 소스 코드가 있어야겠죠.  SPEC CPU 2006 은 DVD 또는 <code>.iso</code> 파일의 형태로
구매 [2] 될 수 있습니다 (작성 시점에서 SPEC CPU 2006 v1.2 의 가격은 $800 군요).
이렇게 구매된 DVD 안에는 벤치마크 소스코드와 벤치마크의 컴파일과 수행, 검증을
위한 tool 프로그램들의 소스코드, 미리 컴파일된 tool 프로그램들, 벤치마크 실행을
위한 규칙 파일, 그리고 문서등이 들어있습니다.  이 글에선 SPEC CPU 2006 v1.1 을
바탕으로 설명합니다.  <code>.iso</code> 파일을 구했다면 다음과 같은 명령으로 mount 해서 그
안의 파일들을 보고 사용할 수 있습니다:</p>

<pre><code>$ mkdir tmnt
$ sudo mount -o loop SPEC_CPU2006v1.1.iso ./tmnt
$ ls tmnt
</code></pre>

<p>마운트한 위치에서 곧바로 설치 / 실행을 수행해도 좋지만 파일을 복사해두고
사용하겠습니다.  <code>mount</code> 를 <code>sudo</code> 로 해야하는 관계로 이 파일들의 owner 는
<code>root</code> 이며 쓰기권한도 없습니다.  굳이 <code>root</code> 가 되지 않고도 벤치마크를
설치하고 돌릴 수 있으므로 파일의 owner 와 권한을 바꿔줍니다:</p>

<pre><code>$ mkdir SPEC_CPU2006v1.1
$ cp -R ./tmnt/* SPEC_CPU2006v1.1/
$ sudo umount ./tmnt &amp;&amp; rm -fr ./tmnt
$ sudo chown -R &lt;username&gt; SPEC_CPU2006v1.1
$ sudo chmod -R 755 SPEC_CPU2006v1.1
$ cd SPEC_CPU2006v1.1
</code></pre>

<h1 id="툴-빌드">툴 빌드</h1>

<p>SPEC 에서 사용되는 도구들은 앞서 가져온 <code>.iso</code> 파일 안에 redhat, suse 등 여러
플랫폼 용으로 미리 빌드되어 있습니다.  하지만 Ubuntu 를 위한 버전은 없습니다.
따라서 다음과 같이 소스코드로부터 직접 빌드를 해야 합니다:</p>

<pre><code>$ cd tools/src
$ ./buildtools
</code></pre>

<p><code>buildtools</code> 는 셸 스크립트로, <code>tools/src</code> 아래 있는 각 툴들을 빌드합니다.
곧바로 진행되면 좋겠지만, 다음과 같은 에러들이 발생합니다.</p>

<h2 id="conflicting-types-for-getline">Conflicting types for &lsquo;getline&rsquo;</h2>

<p><code>md5sum</code> 빌드 중 다음과 같은 에러 메세지가 나옵니다:</p>

<pre><code>gcc -DHAVE_CONFIG_H    -I/home/sjpark/benchmarks/spec/SPEC_CPU2006v1.1/tools/output/include   -I. -Ilib  -c -o md5sum.o md5sum.c
In file included from md5sum.c:38:0:
lib/getline.h:31:1: error: conflicting types for 'getline'
 getline PARAMS ((char **_lineptr, size_t *_n, FILE *_stream));
 ^
</code></pre>

<p><code>md5sum</code> 빌드 중 <code>getline()</code>, <code>getdelim()</code> 함수가 <code>stdio.h</code> 에서 선언되어
있는데도 <code>getline.h</code> 파일에 또 선언되어서 conflicting type 으로 나는
문제입니다.  역시 툴 중 하나인 <code>tar</code> 의 경우엔 GLIBC 버전을 체크해 2 이상일
경우엔 해당 declaration 을 제거해 두었는데, <code>md5sum</code> 아래의 <code>getline.h</code> 엔 이
체크가 없기 때문에 문제가 됩니다.  다음과 같이 GLIBC 버전 체크를 추가해
중복선언이 없도록 수정해 줍니다:</p>

<pre><code>--- a/tools/src/specmd5sum/lib/getline.h
+++ b/tools/src/specmd5sum/lib/getline.h
@@ -27,10 +27,14 @@ Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
 #  endif
 # endif

+# if __GLIBC__ &lt; 2
+
 int
 getline PARAMS ((char **_lineptr, size_t *_n, FILE *_stream));

 int
 getdelim PARAMS ((char **_lineptr, size_t *_n, int _delimiter, FILE *_stream));

+#endif
+
 #endif /* not GETLINE_H_ */
</code></pre>

<h2 id="undefined-reference-to-pow">Undefined reference to <code>pow</code></h2>

<p>이 문제와 아래의 두개의 문제는 인터넷 상의 SPEC CPU 2000 에 대한 비슷한 문제의
해결책[3] 을 참고했습니다.</p>

<p>이제 <code>perl</code> 빌드 중 다음과 같은 에러 메세지가 발생합니다:</p>

<pre><code>cc -L/home/sjpark/benchmarks/spec/SPEC_CPU2006v1.1/tools/output/lib -L/usr/local/lib -o miniperl \
            miniperlmain.o opmini.o libperl.a
libperl.a(pp.o): In function `Perl_pp_pow':
pp.c:(.text+0x2a76): undefined reference to `pow'
</code></pre>

<p><code>pow</code> 함수를 찾지 못하는 문제로, <code>libm</code> 라이브러리를 링크 시점에 링크하도록
알려줘야 합니다.  다음과 같이 <code>PERLFLAGS</code> 환경변수를 설정하고 <code>buildtools</code> 를
실행하는 것으로 해결할 수 있습니다:</p>

<p><code>$ PERLFLAGS=&quot;-A libs=-lm -A libs=-ldl&quot; ./buildtools</code></p>

<h2 id="asm-page-h-file-not-found"><code>asm/page.h</code> file not found</h2>

<p>커널 헤더파일인 <code>asm/page.h</code> 파일을 <code>tools/src/perl-5.8.8/ext/IPC/SysV/SysV.xs</code>
파일에서 <code>include</code> 하고 있어 발생하는 문제가 다음과 같이 발생합니다:</p>

<pre><code>cc -c   -I/home/sjpark/benchmarks/spec/SPEC_CPU2006v1.1/tools/output/include -fno-strict-aliasing -pipe -Wdeclaration-after-statement -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O2   -DVERSION=\&quot;1.04\&quot; -DXS_VERSION=\&quot;1.04\&quot; -fpic &quot;-I../../..&quot;   SysV.c
SysV.xs:7:25: fatal error: asm/page.h: No such file or directory
</code></pre>

<p><code>SysV.xs</code> 파일의 해당 <code>include</code> 문을 다음과 같이 막고 <code>PAGE_SIZE</code> 를 정의해준다.</p>

<pre><code>--- a/tools/src/perl-5.8.8/ext/IPC/SysV/SysV.xs
+++ b/tools/src/perl-5.8.8/ext/IPC/SysV/SysV.xs
@@ -4,7 +4,7 @@

 #include &lt;sys/types.h&gt;
 #ifdef __linux__
-#   include &lt;asm/page.h&gt;
+#define PAGE_SIZE      4096
 #endif
</code></pre>

<h2 id="you-haven-t-done-a-make-depend-yet">You haven&rsquo;t done a &ldquo;make depend&rdquo; yet!</h2>

<p>이어서 다음 에러 메세지가 나옵니다.</p>

<pre><code>You haven't done a &quot;make depend&quot; yet!
make[1]: *** [hash.o] Error 1
</code></pre>

<p><code>perl</code> 빌드 중 사용되는 <code>/bin/sh</code> 은 <code>/bin/dash</code> 를 가리키고 있는데, <code>dash</code>
에서 생기는 문제입니다.  다음과 같이 심볼릭 링크를 수정해 <code>bin/sh</code> 이 <code>bash</code> 를
가리키도록 하면 문제는 해결됩니다.</p>

<pre><code>$ sudo rm /bin/sh
$ sudo ln -s /bin/bash /bin/sh
</code></pre>

<p>시스템을 원래대로 돌리고 싶다면 빌드 끝나고 나중에 심볼릭 링크를 되돌리면
됩니다.</p>

<h2 id="perl-test-fail"><code>perl</code> test fail</h2>

<p>위의 해결책을 모두 적용하고 <code>$ PERLFLAGS=&quot;-A libs=-lm -A libs=-ldl&quot;
./buildtools</code> 를 수행하면 perl 쪽의 테스트 약 900개 가운데 9개 정도 fail 나는
문제가 있긴 하지만 이건 무시하겠다고 하면 무시가 되고 빌드 진행이 됩니다.
테스트 9개가 fail 났는데 무시하겠냐는 질문이 아래와 같이 뜨는데, 무시하겠다고
답해줍시다 (해당 프롬프트에서 설명하는대로, <code>y</code> 를 입력하면 됩니다).</p>

<pre><code>Failed 9 test scripts out of 907, 99.01% okay.
### Since not all tests were successful, you may want to run some of
### them individually and examine any diagnostic messages they produce.
### See the INSTALL document's section on &quot;make test&quot;.
### You have a good chance to get more information by running
###   ./perl harness
### in the 't' directory since most (&gt;=80%) of the tests succeeded.
### You may have to set your dynamic library search path,
### LD_LIBRARY_PATH, to point to the build directory:
###   setenv LD_LIBRARY_PATH `pwd`:$LD_LIBRARY_PATH; cd t; ./perl harness
###   LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; cd t; ./perl harness
###   export LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH; cd t; ./perl harness
### for csh-style shells, like tcsh; or for traditional/modern
### Bourne-style shells, like bash, ksh, and zsh, respectively.
u=0.92  s=0.69  cu=89.23  cs=5.47  scripts=907  tests=112394
make[2]: *** [_test_tty] Error 1
make[2]: Leaving directory `/home/sjpark/benchmarks/spec/SPEC_CPU2006v1.1/tools/src/perl-5.8.8'
make[1]: *** [_test] Error 2
make[1]: Leaving directory `/home/sjpark/benchmarks/spec/SPEC_CPU2006v1.1/tools/src/perl-5.8.8'
make: *** [test] Error 2
+ '[' 2 -ne 0 ']'
+ set +x


Hey!  Some of the Perl tests failed!  If you think this is okay, enter y now:
</code></pre>

<h2 id="build-success">Build success</h2>

<p>여기까지 오면 이제 빌드가 완료됩니다.</p>

<pre><code>Tools built successfully.  Go to the top of the tree and
source the shrc file.  Then you should be ready.
$
</code></pre>

<h1 id="conclusion">Conclusion</h1>

<p>SPEC CPU 2006 을 Ubuntu 16.04 에 설치하는 과정을 알아봤습니다.  다음 글에서는
SPEC CPU 벤치마크를 실행해 보는 방법을 설명합니다.</p>

<hr />

<p>[0] <a href="http://spec.org/">http://spec.org/</a></p>

<p>[1] <a href="http://spec.org/benchmarks.html#cpu">http://spec.org/benchmarks.html#cpu</a></p>

<p>[2] <a href="http://spec.org/order.html">http://spec.org/order.html</a></p>

<p>[3] <a href="https://wiki.linaro.org/MichaelHope/Sandbox/BuildingSPECTools">https://wiki.linaro.org/MichaelHope/Sandbox/BuildingSPECTools</a></p>

      </article>

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="https://sjp38.github.io/post/fetching-linux-source-code/" data-toggle="tooltip" data-placement="top" title="Fetching linux kernel source code">&larr; Previous Post</a>
        </li>
        
        
      </ul>

      

    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/sjp38" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
		      
          <li>
            <a href="mailto:sj38.park@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="https://linkedin.com/in/seongjae-park-1a5b9954" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	    	  
          
           
          
          
          

    		  <li>
      			<a href="https://sjp38.github.io/index.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="credits copyright text-muted">
    	  SeongJae Park
    	  &nbsp;&bull;&nbsp;
    	  2017
    		  
    	  
    	  &nbsp;&bull;&nbsp;
    	  <a href="https://sjp38.github.io/">Happy Hacking</a>
    	  
  	    </p>
  	    
    	<p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.18-DEV</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
    	</p>
      </div>
    </div>
  </div>
</footer>

<script src="https://sjp38.github.io//js/jquery-1.11.2.min.js"></script>
<script src="https://sjp38.github.io//js/bootstrap.min.js"></script>
<script src="https://sjp38.github.io//js/main.js"></script>
<script src="https://sjp38.github.io/js/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30621335-1', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
