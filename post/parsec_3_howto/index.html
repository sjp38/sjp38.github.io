<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Parsec 3.0 설치 / 사용법</title>
  
  <meta name="author" content="SeongJae Park"/>
  <meta name="generator" content="Hugo 0.31.1" />
  

  <link rel="alternate" href="https://sjp38.github.io/index.xml" type="application/rss+xml" title="Happy Hacking">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://sjp38.github.io//css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://sjp38.github.io/css/highlight.min.css">
  
  
  <meta property="og:title" content="Parsec 3.0 설치 / 사용법" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/post/parsec_3_howto/" />
  <meta property="og:image" content="/img/tux.png" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://sjp38.github.io/">Happy Hacking</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
          <a title="Categories" href="/categories">Categories</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Projects" href="/categories/projects">Projects</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Tags" href="/tags">Tags</a>
  	      </li>
  	    
      
        
          <li>
          <a title="About" href="/post/about/">About</a>
  	      </li>
  	    
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
          <a title="Happy Hacking" href="https://sjp38.github.io/">
              <img class="avatar-img" src="https://sjp38.github.io//img/tux.png" alt="Happy Hacking" />
          </a>
      
	  </div>
	</div>

  </div>
</nav>

    



  

  <header class="header-section ">
  
  <div class="intro-header no-img">
      <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Parsec 3.0 설치 / 사용법</h1>
      
      
      
      <span class="post-meta">Posted on May 19, 2017</span>
      
        </div>
      </div>
    </div>
  </div>
  </div>
  </header>


    <div class="container" role="main">	  
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
          

<p>PARSEC 은 멀티쓰레드 프로그램들로 구성된 benchmark suite 입니다.  멀티쓰레드로
구성되어 있기 때문에 멀티코어 시스템에서의 multi core scalability 를 테스트
하기에도 적합합니다.  이 글에선 현재 최신 버전인 3.0 버전의 PARSEC 을 Ubuntu
16.04 server 에 설치하면서 겪는 문제의 해결법과 간단한 사용법을 정리해 봅니다.</p>

<h1 id="toolbox-for-parsec-3-0-on-ubuntu-xenial">Toolbox for PARSEC 3.0 on Ubuntu Xenial</h1>

<p>아래의 내용을 하나하나 읽어가면서 따라하는 것도 귀찮은 일입니다.  그래서
아래에서 설명하는, Ubuntu Xenial 에서 PARSEC 3.0 을 돌리기 위해 필요한 작업을
대부분 자동으로 해주는 도구들을 만들어 두었습니다.  오픈소스로 공개되어
있으니[1], 아래의 머리 아픈 내용을 읽기 귀찮다면 해당 도구들을 사용하시기
바랍니다.  해당 도구들의 사용법은 README 에 간략히 설명되어 있습니다.</p>

<p>[1] <a href="https://github.com/sjp38/parsec_on_ubuntu_xenial">https://github.com/sjp38/parsec_on_ubuntu_xenial</a></p>

<h1 id="parsec-3-0-download">PARSEC 3.0 Download</h1>

<p>공식 홈페이지[1] 에 들어가면 PARSEC 3.0 다운로드 링크가 첫페이지부터 있습니다.
해당 링크를 사용하면 <code>tar.gz</code> 포맷의 tarball 로 정리된 PARSEC 3.0 을 다운받을
수 있습니다.  웹브라우저로 들어가서 다운로드를 받는 방법도 있겠고, <code>curl</code> 이나
<code>wget</code> 등의 command line tool 을 사용해 다운받을 수도 있겠습니다.  다음
커맨드는 PARSEC 3.0 을 다운받아 <code>parsec-3.0/</code> 디렉토리 아래 압축을 풀고 압축을
푼 디렉토리로 이동합니다.</p>

<pre><code>$ wget http://parsec.cs.princeton.edu/download/3.0/parsec-3.0.tar.gz
$ tar zxvf parsec-3.0.tar.gz
$ cd parsec-3.0
</code></pre>

<h1 id="build">Build</h1>

<p>이제 PARSEC 3.0 을 빌드해야 합니다.  PARSEC 은 여러 벤치마크를 포함하고
있으므로 개별적 벤치마크를 하나하나 직접적으로 다루기보다는 suite 내의 각
벤치마크를 통합적으로 관리할 수 있는 <code>parsecmgmt</code> 라는 관리 프로그램을
사용하도록 되어 있습니다.  빌드 역시 마찬가지입니다.  참고로, <code>parsecmgmt</code> 는
bash script 입니다.</p>

<p>기본적인 PARSEC 3.0 빌드 방법은 다음과 같이 간단합니다:</p>

<pre><code>$ source ./env.sh
$ parsecmgmt -a build
</code></pre>

<p>첫번째 커맨드는 parsecmgmt 의 경로를 PATH 에 추가하는 등, 환경 변수 설정 등의
일을 처리해 주며, 두번째의 간단한 커맨드가 전체 PARSEC 3.0 빌드 프로세스를
수행하게 됩니다.</p>

<h2 id="perl-version-problem">Perl Version Problem</h2>

<p>하지만 Ubuntu 16.04 server 에서는 다음과 같은 에러 메세지를 내뱉으며 빌드에
실패합니다:</p>

<pre><code>smime.pod around line 272: Expected text after =item, not a number
smime.pod around line 276: Expected text after =item, not a number
smime.pod around line 280: Expected text after =item, not a number
smime.pod around line 285: Expected text after =item, not a number
smime.pod around line 289: Expected text after =item, not a number
POD document had syntax errors at /usr/bin/pod2man line 68.
make: *** [install_docs] Error 1
Makefile:680: recipe for target 'install_docs' failed
[PARSEC] Error: 'env PATH=/usr/local/sbin:...' failed.
</code></pre>

<p>에러 메세지에서 유추할 수 있듯 PARSEC 3.0 의 소스 코드 중 smime.pod 파일이
문법에 맞지 않아 생긴 문제입니다.  참고로 pod 는 perl 프로그램 문서화에
사용되는 간단한 markup language 입니다[2].  Ubuntu 16.04 는 perl 5.22.1 버전을
기본으로 사용하고 있는데, PARSEC 3.0 에 있는 코드는 perl 5.14.2 버전에 맞춰져
있으며 최신 버전으로 오는 사이 문법이 바뀐 것으로 인한 문제로 보입니다.
해결책은 두가지가 있습니다.</p>

<p><strong>방법 1: perl 5.14.2 설치</strong></p>

<p>Google groups 의 관련 쓰레드[3] 를 참고한 방법입니다.
5.14.2 버전의 perl 소스코드를 받아와 이를 설치하고 PARSEC 빌드에 이 버전의 perl
을 사용하는 방법입니다.  다음의 커맨드로 <code>~/localperl/</code> 디렉토리 아래 5.14.2
버전 perl 을 설치하고 사용할 수 있습니다.</p>

<pre><code>wget http://www.cpan.org/src/5.0/perl-5.14.2.tar.gz
$ tar zxvf perl-5.14.2.tar.gz
$ cd perl-5.14.2/
$ mkdir ~/localperl
$ ./Configure -des -Dprefix=$HOME/localperl
$ time make -j
$ make test
$ make install
$ ~/localperl/bin/perl -v
</code></pre>

<p><strong>방법 2: pod 파일 문법 오류 수정</strong></p>

<p>좀 더 정공법에 가까운 방법으로, 다음 글을 참고한 해결책입니다:
<a href="https://yulistic.gitlab.io/2016/05/parsec-3.0-installation-issues/">https://yulistic.gitlab.io/2016/05/parsec-3.0-installation-issues/</a></p>

<p>최신 버전의 문법에 맞게 pod 파일의 문제시 되는 부분들을 고쳐주는 것으로,
문제되는 모든 pod 파일의 <code>=item [0-9]</code> 을 <code>=item C&lt;[0-9]&gt;</code> 으로 바꿔줍니다.
<code>diff</code> 로 표현하면 다음과 같은 수정을 가하게 되겠습니다:</p>

<pre><code>--- a/pkgs/libs/ssl/src/doc/apps/smime.pod
+++ b/pkgs/libs/ssl/src/doc/apps/smime.pod
@@ -265,28 +265,28 @@ encrypted data is used for other purposes.

 =over 4

-=item 0
+=item C&lt;0&gt;

 the operation was completely successfully.

-=item 1
+=item C&lt;1&gt;

 an error occurred parsing the command options.

-=item 2
+=item C&lt;2&gt;

 one of the input files could not be read.

-=item 3
+=item C&lt;3&gt;

 an error occurred creating the PKCS#7 file or when reading the MIME
 message.

-=item 4
+=item C&lt;4&gt;

 an error occurred decrypting or verifying the message.

-=item 5
+=item C&lt;5&gt;

 the message was verified correctly but an error occurred writing out
 the signers certificates.
</code></pre>

<p>이렇게 파일 하나하나 수정하면 이 에러 메세지는 사라집니다.  참고한 링크에서는
하나하나 손으로 수정하기보다는 다음과 같이 간단한 bash shell script 를 짜서
일괄적으로 수정하는 걸 추천합니다:</p>

<pre><code>#! /bin/bash
for i in 0 1 2 3 4 5 6 7 8 9 
do
    echo &quot;Replacing '=item $i' to '=item C&lt;$i&gt;'&quot;
    grep -rl &quot;=item $i&quot; * | xargs sed -i &quot;s/=item $i/=item C&lt;$i&gt;/g&quot;
done
</code></pre>

<p>이어서 설명할 문제들과 해결책도 해당 링크를 참고한 것임을 밝혀둡니다.</p>

<h2 id="mbstate-t-conflict"><code>__mbstate_t</code> Conflict</h2>

<p>앞의 에러 메세지는 사라지지만 이제 다음과 같은 에러 메세지가 나올 겁니다:</p>

<pre><code>/usr/include/wchar.h:94:3: error: conflicting types for ‘__mbstate_t’
 } __mbstate_t;
   ^
In file included from ../include/machine/bsd_endian.h:37:0,
                 from ../include/sys/bsd_types.h:44,
                 from ../include/sys/bsd_param.h:64,
                 from if_host.c:48:
../include/sys/bsd__types.h:105:3: note: previous declaration of ‘__mbstate_t’ was here
 } __mbstate_t;
   ^
In file included from ../include/net/bsd_if_var.h:82:0,
                 from ../include/net/bsd_if.h:459,
                 from if_host.c:57:
../include/sys/bsd_buf_ring.h: In function ‘buf_ring_dequeue_sc’:
../include/sys/bsd_buf_ring.h:200:33: warning: variable ‘cons_next_next’ set but not used [-Wunused-but-set-variable]
  uint32_t cons_head, cons_next, cons_next_next;
                                 ^
make[1]: *** [if_host.o] Error 1
</code></pre>

<p><code>basd__types.h</code> 파일에 <code>__mbstate_t</code> 타입을 중복 정의했기 때문에 발생한
문제입니다.  해당 파일에서 해당 정의 부분을 다음과 같이 주석 처리하면 이 문제는
사라집니다.</p>

<pre><code>diff --git a/pkgs/libs/uptcpip/src/include/sys/bsd__types.h b/pkgs/libs/uptcpip/src/include/sys/bsd__types.h
index fa1b0f0f26d9..bd7e6a97f4c8 100644
--- a/pkgs/libs/uptcpip/src/include/sys/bsd__types.h
+++ b/pkgs/libs/uptcpip/src/include/sys/bsd__types.h
@@ -93,6 +93,7 @@ typedef       __ct_rune_t     __wint_t;       /* wint_t (see above) */

 typedef        __uint32_t      __fixpt_t;      /* fixed point number */

+#if 0  /* Skip conflicting __mbstate_t definition */
 /*
  * mbstate_t is an opaque object to keep conversion state during multibyte
  * stream conversions.
@@ -104,5 +105,6 @@ typedef union {
        __int64_t       _mbstateL;      /* for alignment */
 } __mbstate_t;
 #endif
+#endif /* Skip conflicting __mbstate_t definition */

 #endif /* !_BSD_SYS__TYPES_H_ */
</code></pre>

<h2 id="pkg-config-package-not-found">pkg-config Package Not Found</h2>

<p>성공적인 빌드를 위해선 당연하지만 PARSEC 3.0 이 의존성을 가진 패키지가 모두
설치되어 있어야 합니다.  이를 주의 깊게 미리 설치해 두지 않았다면 다음과 같은
에러 메세지를 만날 수도 있습니다:</p>

<pre><code>configure: error: *** pkg-config not found. See http://www.freedesktop.org/software/pkgconfig/
[PARSEC] Error: ...
</code></pre>

<p>위 메세지는 <code>pkg-config</code> 프로그램이 설치되어 있지 않아서 발생한 문제임을 알 수
있습니다.  간단히 Ubuntu 의 package 시스템인 apt 를 사용해 다음과 같이 해당
프로그램을 설치해 주면 문제는 사라집니다.</p>

<pre><code>$ sudo apt install pkg-config
</code></pre>

<h2 id="build-success">Build Success</h2>

<p>이 정도까지가 나타날 수 있는 대부분의 문제입니다.  위 해결책들을 모두
적용했다면 아마 빌드에 성공할 겁니다.  빌드에 성공하면 다음과 같이 성공했다는
메세지를 볼 수 있을 겁니다:</p>

<pre><code>[PARSEC]
[PARSEC] BIBLIOGRAPHY
[PARSEC]
[PARSEC] [1] Bienia. Benchmarking Modern Multiprocessors. Ph.D. Thesis, 2011.
[PARSEC] [2] Woo et al. The SPLASH-2 Programs: Characterization and Methodological Considerations. ISCA, 1995.
[PARSEC]
[PARSEC] Done.
</code></pre>

<p>참고로 빌드에 꽤 긴 시간이 소모됩니다.  제가 사용한 72 코어 / 144 쓰레드
머신에서도 약 10분이 걸렸습니다.</p>

<h1 id="simple-usage">Simple Usage</h1>

<p>이제 빌드가 잘 되었는지 돌려봐야 할 차례입니다.  다음 커맨드는 각 벤치마크를
가장 작은 크기의 데이터셋을 가지고 실행해 보기 때문에 각 벤치마크가 돌아가긴
하는지만 보는데 적격입니다:</p>

<pre><code>parsecmgmt -a run
</code></pre>

<p>가장 작은 크기의 데이터셋을 사용하기 때문에 모든 벤치마크를 수행하지만 빠르게
종료됩니다.</p>

<h2 id="parsecmgmt-options"><code>parsecmgmt</code> Options</h2>

<p><code>-a</code> 옵션은 action 을 의미합니다.  앞의 섹션에서는 빌드를 위해 여기에 <code>build</code>
값을 주었고, 여기선 벤치마크 수행을 위해 <code>run</code> 값을 준 것입니다.</p>

<p><code>-i</code> 옵션을 통해 벤치마크들은 워크로드에서 사용할 데이터 크기를 지정할 수
있습니다.  이 인자의 값으로 test, simdev, simsmall, simmedium, simlarge, native
를 줄 수 있습니다.  Test 는 정확성 테스트만을 위한, 빨리 끝나는 데이터로 이
인자를 주지 않으면 default 로 이 값이 취해집니다.  native 는 가장 realworld
workload 에 가까운 벤치마크를 위한 데이터라 볼 수 있습니다.</p>

<p><code>-p</code> 옵션을 통해 어떤 sub benchmark 를 돌릴지 정할 수 있습니다.  이 옵션을
별도로 주지 않으면 모든 benchmark 를 돌리게 됩니다.</p>

<p><code>-n</code> 옵션은 number of threads to use 입니다.</p>

<p>예를 들어 <code>parsecmgmt -p canneal -a run -i native -n 1</code> 은 <code>canneal</code> sub
benchmark 하나만을 쓰레드 한개 써서 <code>native</code> 데이터셋으로 실행합니다.</p>

<h1 id="references">References</h1>

<p>[1] <a href="http://parsec.cs.princeton.edu">http://parsec.cs.princeton.edu</a><br />
[2] <a href="https://en.wikipedia.org/wiki/Plain_Old_Documentation">https://en.wikipedia.org/wiki/Plain_Old_Documentation</a><br />
[3] <a href="https://groups.google.com/forum/#!topic/snipersim/_1qpbmpPRtg">https://groups.google.com/forum/#!topic/snipersim/_1qpbmpPRtg</a></p>

      </article>

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="https://sjp38.github.io/post/xclip_copy_remote_clipboard/" data-toggle="tooltip" data-placement="top" title="원격 데스크탑의 clipboard 를 ssh 와 xclip 으로 복사해오기">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="https://sjp38.github.io/post/lkml_go/" data-toggle="tooltip" data-placement="top" title="lkml livestream">Next Post &rarr;</a>
        </li>
        
      </ul>

      

    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/sjp38" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
		      
          <li>
            <a href="mailto:sj38.park@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="https://linkedin.com/in/seongjae-park-1a5b9954" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	    	  
          
           
          
          
          

    		  <li>
      			<a href="https://sjp38.github.io/index.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="credits copyright text-muted">
    	  SeongJae Park
    	  &nbsp;&bull;&nbsp;
    	  2017
    		  
    	  
    	  &nbsp;&bull;&nbsp;
    	  <a href="https://sjp38.github.io/">Happy Hacking</a>
    	  
  	    </p>
  	    
    	<p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.31.1</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
    	</p>
      </div>
    </div>
  </div>
</footer>

<script src="https://sjp38.github.io//js/jquery-1.11.2.min.js"></script>
<script src="https://sjp38.github.io//js/bootstrap.min.js"></script>
<script src="https://sjp38.github.io//js/main.js"></script>
<script src="https://sjp38.github.io/js/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30621335-1', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
